pipeline {
    agent any
    tools{
        maven 'maven'
    }
    stages{
        stage('Code checkout'){
            steps{
                git credentialsId: 'git_credential', url: 'https://github.com/pankaj3091/my-app.git'
            }
        }
        stage('Compile-package'){
            steps{
                // Get maven home path
                bat 'mvn clean package deploy'
                }
        }
	stage("Consolidate Results") {
		steps {
			input ("Do you want to capture results?")
			junit '**/target/surefire-reports/TEST-*.xml'
			archiveArtifacts  'target/*.jar'
			}
		}
	stage("Email Build Status"){
		steps {
			mail bcc: '', body: 'Sample body', cc: '', from: '', replyTo: '', subject: 'Declarative-Pipeline Project', to: 'pankaj.jalalpure@gmail.com'
		}
	}
        stage('Upload War To Nexus'){
            steps{
                nexusArtifactUploader artifacts: [
				[
					artifactId: 'my-app', 
					classifier: '', 
					file: 'target/my-app-1.0-SNAPSHOT.jar', 
					type: 'jar'
					]
				], 
					credentialsId: 'nexus_id', 
					groupId: 'com.mycompany.app', 
					nexusUrl: 'localhost:8081', 
					nexusVersion: 'nexus3', 
					protocol: 'http', 
					repository: 'http://localhost:8081/repository/SAMPLE-SNAP/', 
					version: '1.0-SNAPSHOT'
            }
        } 
    }
}
